{% extends "base.html" %}
{% block content %}

<!-- Make this page use almost full width and keep key cells on one line -->
<style>:root { --content-w: clamp(1200px, 95vw, 1480px); }</style>

<h2>Match History</h2>

<form method="get" class="filters">
  <label>
    Season
    <select name="season" onchange="this.form.submit()">
      <option value="">All</option>
      {% for s in seasons %}
        <option value="{{ s }}" {% if selected.season == s %}selected{% endif %}>S{{ s }}</option>
      {% endfor %}
    </select>
  </label>

  <label>
    Tournament
    <select name="tournament" onchange="this.form.submit()">
      <option value="">All</option>
      {% for t in tournaments %}
        <option value="{{ t }}" {% if selected.tournament|lower == t|lower %}selected{% endif %}>{{ t }}</option>
      {% endfor %}
    </select>
  </label>

  <label>
    Competitor (name contains)
    <input type="text" name="competitor" value="{{ selected.competitor }}" placeholder="e.g. Cena or The Usos" />
  </label>
  <button class="btn btn-small" type="submit">Filter</button>
  <a class="btn btn-small" href="/matches">Reset</a>
</form>

{% if not matches %}
  <p class="muted">No matches found.</p>
{% else %}
  <table>
    <thead>
      <tr>
        <th style="width:6rem;">Season</th>
        <th>Tournament</th>
        <th>Round</th>
        <th>Stipulation</th>
        <th>Match</th>
        <th>Result</th>
        <th style="width:5rem;">Time</th>
        <th style="width:1%;"></th>
      </tr>
    </thead>
    <tbody>
      {% for m in matches %}
        <tr>
          <td>S{{ m.season }}</td>
          <td>{{ m.tournament }}</td>
          <td class="round-col">{{ m.round }}</td>
          <td>{{ m.stipulation or 'â€”' }}</td>
          <td class="match-col">{{ m.match_display_html | safe }}</td>
          <td class="nowrap"><strong>{{ m.result_display_html | safe }}</strong></td>
          <td>{{ m.match_time_display }}</td>
          <td><a class="btn btn-small" href="/matches/edit/{{ m.id }}">Edit</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}

{% endblock %}
