{% extends "base.html" %}
{% block content %}
  <h2>{{ heading }}</h2>
  {% if error %}
    <p class="error">{{ error }}</p>
  {% endif %}

  <form method="post" action="{{ action_url }}" {% if allow_photo_upload %}enctype="multipart/form-data"{% endif %}>
    <div class="field">
      <label for="name">Name</label>
      <input type="text" id="name" name="name" value="{{ form.name }}" required
             autocomplete="off" autocapitalize="none" spellcheck="false"
             readonly onfocus="this.removeAttribute('readonly');">
    </div>

    <div class="field">
      <label for="gender">Gender</label>
      <select id="gender" name="gender">
        <option value="Male"   {% if form.gender == 'Male' %}selected{% endif %}>Male</option>
        <option value="Female" {% if form.gender == 'Female' %}selected{% endif %}>Female</option>
      </select>
    </div>

    <div class="field">
      <label for="active">Active</label>
      <select id="active" name="active">
        <option value="Yes" {% if form.active == 'Yes' %}selected{% endif %}>Yes</option>
        <option value="No"  {% if form.active == 'No'  %}selected{% endif %}>No</option>
      </select>
    </div>

    {% if allow_photo_upload %}
      <div class="field">
        <label>Photo</label>
        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
          {% if form.photo %}
            <img src="{{ form.photo }}" alt="{{ form.name }} photo" class="profile-photo">
          {% else %}
            <div style="width:180px; height:180px; border:1px dashed var(--line); border-radius:12px; display:flex; align-items:center; justify-content:center; color:var(--muted);">No photo</div>
          {% endif %}
          <div style="display:flex; flex-direction:column; gap:6px;">
            <input type="file" id="photo" name="photo" accept="image/jpeg,image/png,image/webp">
            <small class="muted">JPEG/PNG/WebP, up to 8&nbsp;MB.</small>
          </div>
        </div>
      </div>
    {% endif %}

    <p>
      <button class="btn" type="submit">Save</button>
      <a class="btn" href="/roster">Cancel</a>
    </p>
  </form>

  <script>
    // Focus name on load
    window.addEventListener('load', () => {
      const el = document.getElementById('name');
      if (el) {
        el.focus();
        // put caret at end
        const v = el.value; el.value = ''; el.value = v;
      }
    });
  </script>
{% endblock %}
