{% extends "base.html" %}
{% block content %}
  <h2>{{ champ.name }}</h2>

  <table>
    <tbody>
      <tr>
        <th style="width:140px">Mode</th>
        <td>{{ champ.mode }}</td>
      </tr>
      <tr>
        <th>Gender</th>
        <td>{{ champ.gender }}</td>
      </tr>
      <tr>
        <th>Stipulation</th>
        <td>{{ champ.stipulation or '—' }}</td>
      </tr>
    </tbody>
  </table>

  <p style="margin-top:12px">
    <a class="btn" href="/championships">Back to list</a>
    <a class="btn" href="/championships/edit/{{ champ.id }}">Edit championship</a>
  </p>

  {% if champ.mode == 'Seasonal' %}


    <script>
      function togglePickers(){
        var type = document.getElementById('champion_type').value;
        var isTeam = type === 'team';
        document.getElementById('pick_wrestler').style.display = isTeam ? 'none' : '';
        document.getElementById('pick_team').style.display     = isTeam ? '' : 'none';
        var ruW = document.getElementById('ru_wrestler');
        var ruT = document.getElementById('ru_team');
        if(ruW && ruT){
          ruW.style.display = isTeam ? 'none' : '';
          ruT.style.display = isTeam ? '' : 'none';
        }
      }
      document.addEventListener('DOMContentLoaded', togglePickers);
    </script>

    <h3 style="margin-top:24px; margin-bottom:8px;">Seasons</h3>
    {% if not seasonal_rows %}
      <p class="muted">No seasons recorded yet.</p>
    {% else %}
      <table>
        <thead>
          <tr>
            <th style="width:6rem;">Season</th>
            <th>Champion</th>
            <th>Runner-up</th>
            <th style="width:1%;"></th>
          </tr>
        </thead>
        <tbody>
          {% for r in seasonal_rows %}
            <tr>
              <td>S{{ r.season }}</td>
              <td>{{ r.champion or '—' }}</td>
              <td>{{ r.runner_up or '—' }}</td>
              <td>
                <form class="inline-form" method="post" action="/championship/{{ champ.id }}/season/delete">
                  <input type="hidden" name="season" value="{{ r.season }}" />
                  <button class="btn btn-small btn-danger" type="submit">Delete</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}

  {% else %}
    <h3 style="margin-top:24px; margin-bottom:8px;">Ongoing title</h3>
    {% if not current_reign %}
      <form class="filters" method="post" action="/championship/{{ champ.id }}/reigns/start">
        <label>Champion
          <select name="champion_id">
            {% for w in wrestlers %}
              <option value="{{ w.id }}">{{ w.name }}</option>
            {% endfor %}
          </select>
        </label>
        <label>Season won
          <input type="number" name="season_won" min="1" value="{{ season }}" />
        </label>
        <label>Champion #
          <input type="number" name="champ_number" min="1" value="1" />
        </label>
        <button class="btn" type="submit">Start reign</button>
      </form>
    {% else %}
      <table>
        <tbody>
          <tr><th>Champion</th><td>{{ current_reign.champion }}</td></tr>
          <tr><th>Season won</th><td>S{{ current_reign.season_won }}</td></tr>
          <tr><th>Champion #</th><td>{{ current_reign.champ_number }}</td></tr>
          <tr><th>Successful defences</th><td>{{ current_reign.defences }}</td></tr>
        </tbody>
      </table>
      <form class="filters" method="post" action="/championship/{{ champ.id }}/reigns/increment">
        <button class="btn" type="submit">+1 Defence</button>
      </form>
      <form class="filters" method="post" action="/championship/{{ champ.id }}/reigns/end">
        <label>Lost on (season marker)
          <input type="text" name="lost_on" placeholder="S{{ season }}" />
        </label>
        <button class="btn btn-danger" type="submit">End reign</button>
      </form>
    {% endif %}

    {% if reign_rows %}
      <h3 style="margin-top:24px; margin-bottom:8px;">Past reigns</h3>
      <table>
        <thead><tr><th>Champion</th><th>Season won</th><th>#</th><th>Defences</th></tr></thead>
        <tbody>
          {% for r in reign_rows %}
            <tr>
              <td>{{ r.champion }}</td>
              <td>S{{ r.season_won }}</td>
              <td>{{ r.champ_number }}</td>
              <td>{{ r.defences }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  {% endif %}
{% endblock %}
