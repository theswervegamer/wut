{% extends "base.html" %}
{% block content %}
  <h2>{{ heading }}</h2>

  <style>
    .grid { display:grid; gap:12px; grid-template-columns: 1fr; }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .card { border:1px solid var(--line); background:#0b0b0b; border-radius:16px; padding:12px; }
    .label { display:block; font-weight:600; margin:6px 0 4px; }
    input[type=text], select, input[type=number] { width:100%; max-width: 380px; padding:10px 12px; background:#0b0b0b; color:var(--fg); border:1px solid var(--line); border-radius:8px; }
    .two { display:grid; gap:12px; grid-template-columns: repeat(2, minmax(220px, 380px)); }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    .muted { color:var(--muted); }
    .photo { width:260px; height:160px; object-fit:contain; border:1px solid var(--line); border-radius:12px; background:#111; }
    .photo-ph { width:260px; height:160px; display:flex; align-items:center; justify-content:center; border:1px dashed var(--line); border-radius:12px; color:var(--muted); }
    table { width:100%; border-collapse:collapse; margin-top:8px; }
    th, td { text-align:left; padding:8px 10px; border-bottom:1px solid var(--line); }
  </style>

  {% if error %}<p class="error">{{ error }}</p>{% endif %}

  <div class="grid">
    <form class="card" method="post" action="{{ action_url }}" enctype="multipart/form-data">
      <div class="two">
        <div>
          <label class="label">Name</label>
          <input type="text" name="name" value="{{ form.name }}" required>
        </div>
        <div>
          <label class="label">Gender</label>
          <select name="gender">
            <option value="Male"   {% if form.gender=='Male' %}selected{% endif %}>Male</option>
            <option value="Female" {% if form.gender=='Female' %}selected{% endif %}>Female</option>
          </select>
        </div>
        <div>
          <label class="label">Stipulation</label>
          <input type="text" name="stipulation" value="{{ form.stipulation }}" placeholder="e.g., Singles, Royal Rumble, ...">
        </div>
        <div>
          <label class="label">Mode</label>
          <select name="mode">
            <option value="Seasonal" {% if form.mode=='Seasonal' %}selected{% endif %}>Seasonal</option>
            <option value="Ongoing"  {% if form.mode=='Ongoing'  %}selected{% endif %}>Ongoing</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        {% if allow_photo_upload %}
          <label class="label" style="width:100%">Belt Photo</label>
          <input type="file" name="photo" accept="image/*">
          {% if form.photo %}
            <img class="photo" src="{{ form.photo }}" alt="Belt photo">
          {% else %}
            <div class="photo-ph">No photo</div>
          {% endif %}
        {% endif %}
      </div>

      <div class="actions" style="margin-top:10px">
        <button class="btn" type="submit">Save</button>
        <a class="btn" href="/championships">Back</a>
      </div>
    </form>

   

  {# Paste this ENTIRE block near the bottom of templates/championship_form.html,
   directly ABOVE the final `{% endblock %}`. It does not replace your existing
   edit fields; it just adds a Seasonal management section on the Edit page. #}

{% if champ.mode == 'Seasonal' %}
  <h3 style="margin-top:24px; margin-bottom:8px;">Set Champion (Seasonal)</h3>

  <form method="post" action="/championship/{{ champ.id }}/season/set" class="card" style="padding:12px; border:1px solid var(--line); border-radius:12px;">
    <div class="filters">
      <label>
        Season
        <input type="number" name="season" min="1" value="{{ season }}" />
      </label>

      <label>
        Type
        <select name="champion_type" id="edit_champion_type" onchange="editTogglePickers()">
          <option value="wrestler">Wrestler</option>
          <option value="team">Team</option>
        </select>
      </label>

      <label id="edit_pick_wrestler">
        Champion (Wrestler)
        <select name="champion_wrestler_id">
          {% for w in wrestlers %}
            <option value="{{ w.id }}">{{ w.name }}</option>
          {% endfor %}
        </select>
      </label>

      <label id="edit_pick_team" style="display:none;">
        Champion (Team)
        <select name="champion_team_id">
          {% for t in teams %}
            <option value="{{ t.id }}">{{ t.name }}</option>
          {% endfor %}
        </select>
      </label>

      {% set stip = champ.stipulation|lower %}
      {% if stip not in ['royal rumble','elimination chamber','rumble','elimination'] %}
        <label id="edit_ru_wrestler">
          Runner-up (Wrestler)
          <select name="runner_up_wrestler_id">
            <option value="">—</option>
            {% for w in wrestlers %}
              <option value="{{ w.id }}">{{ w.name }}</option>
            {% endfor %}
          </select>
        </label>
        <label id="edit_ru_team" style="display:none;">
          Runner-up (Team)
          <select name="runner_up_team_id">
            <option value="">—</option>
            {% for t in teams %}
              <option value="{{ t.id }}">{{ t.name }}</option>
            {% endfor %}
          </select>
        </label>
      {% endif %}

      <button class="btn" type="submit">Save</button>
    </div>
  </form>

  <script>
    function editTogglePickers(){
      var type = document.getElementById('edit_champion_type').value;
      var isTeam = type === 'team';
      document.getElementById('edit_pick_wrestler').style.display = isTeam ? 'none' : '';
      document.getElementById('edit_pick_team').style.display     = isTeam ? '' : 'none';
      var ruW = document.getElementById('edit_ru_wrestler');
      var ruT = document.getElementById('edit_ru_team');
      if(ruW && ruT){
        ruW.style.display = isTeam ? 'none' : '';
        ruT.style.display = isTeam ? '' : 'none';
      }
    }
    document.addEventListener('DOMContentLoaded', editTogglePickers);
  </script>

  <h3 style="margin-top:24px; margin-bottom:8px;">Seasons</h3>
  {% if not seasonal_rows %}
    <p class="muted">No seasons recorded yet.</p>
  {% else %}
    <table>
      <thead>
        <tr>
          <th style="width:6rem;">Season</th>
          <th>Champion</th>
          <th>Runner-up</th>
          <th style="width:1%;"></th>
        </tr>
      </thead>
      <tbody>
        {% for r in seasonal_rows %}
          <tr>
            <td>S{{ r.season }}</td>
            <td>{{ r.champion or '—' }}</td>
            <td>{{ r.runner_up or '—' }}</td>
            <td>
              <form class="inline-form" method="post" action="/championship/{{ champ.id }}/season/delete">
                <input type="hidden" name="season" value="{{ r.season }}" />
                <button class="btn btn-small btn-danger" type="submit">Delete</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
{% endif %}

{% endblock %}
